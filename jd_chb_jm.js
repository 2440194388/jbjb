const $ = new Env('极速版chb');

const notify = $.isNode() ? require('./sendNotify') : '';
//Node.js用户请在jdCookie.js处填写京东ck;
const jdCookieNode = $.isNode() ? require('./jdCookie.js') : '';
let jdNotify = true;//是否关闭通知，false打开通知推送，true关闭通知推送
const randomCount = $.isNode() ? 20 : 5;
//IOS等用户直接用NobyDa的jd cookie
var _0xodB='jsjiami.com.v6',_0x3a90=[_0xodB,'Y2h+w7HDiCA=','w5DDuDNGDQ==','CMOpCBNR','wq95WMKq','w5RdTMOYZA==','wqRiRw==','N8O7w68=','EcK6wqHDlw==','WsKuwq08QMOZZnTCu8K/wqXDqnI9w4s=','TcK3wrI4VQ==','XXxBSjDDp0kgw5nDqsOxG8K8w7B5YcOIw6nDphPDgsOzwrdcesOrUi0iwqkeIw==','eHYGwq4rw7AMOsKjAiTCkMKyJcOqScKlwqXDkwARwpDCusOXEMKnwp/Cv1ZoWTM=','WMOPeMOXYcOG','dFnCmk/DqsOkEA==','w4txw4fCjA==','OcOSSw==','d1jCng==','w5JkwrBww6lRwo/CgA==','bsOxwplNw7jDt8Os','w5rDhxBMEmEQwrM=','w5xhw4DCgDLDtCU=','woDDpcOUDMOGdzh8YA==','HCglZcKCw7kX','NsK0wrrDncKNXcOmw49f','wq7Dq8OL','UzdzwqUTdw==','44CM5o+l56eL44OZ6K6w5YaT6I+E5Y2/5Luq5LiQ6LaI5Y6g5LixC8K8w6sJw6nDm0znmrbmjKfkvK/nl6/DicO7Qx8Iwo/nm5LkuI3ku5vnr7fli7LojpvljYg=','McOPWg==','wqfCrMKqDQ==','wqXDiMO/NcO+','firDpyzDvQ==','WCxowr4JKGLCnsOVw7rCpV7Cmn7CgsK8w5R9w5oCY0AVwoN/HWFHw588w6I2SsO6wrjDs8O2w4PDujs9f2M=','w6rCicKcw6nCnA==','GQJjw499','ICpZw7ltw7o=','FyI2','wpAnw7LCoA==','w4bClzzDoXc=','wp1uw4k=','V8Kpwro0WQ==','wo/Dk3LCriXChhDDjsOeGg==','UsOdQsObbQ==','w7Mew54=','w4HCmDXDoQ==','HHjlpK3ot6tbMuWPkuWZkcKNwr8=','VjFywq8WfjQ=','bcO7woNM','w7gDVw06','w6lTRMOCbcKtOsKSe8KcP8K6Y1bCpG19Y8OzI8KhwqxBw7xQDMOTwpw6w4HDjhjDscOlwqPCrsOSYwfDgsOUwrs2DyrCnMK/wrptw58oI8OEw4rDjEFeMB9IOh5HfsKRPBfChcKcwpLDlxrDhlvCqMO0w4klYMKxVsKHJ8KxwqvCuMOFw7PDoiEOFQo6fcO2VHtyNcKhTEXCrsOvw5vCgcOccHMWw77DoMK2Q1rDnmzCrjjDuiMPw6TCu8OYM8KRw7nCkEbChH5qCcKzRMKCPcOVwr8FQSoPwrQMw5TCjsO0wqPCvTPDuMO5JQ==','L0xFShs=','QnTDh8KSIQ==','XR3DrMOfLw==','U3rCqn7DjQ==','e1DChQ==','wo8yw6/CpB9sw4pswojCrxjDhwQrRSbDrsKew6wBwoVQf1ZqeiDCpG5awqbDmmB9KsO2wrnDkcOTUU43w7vChXTDlsOcACISMMORN8OuXUjCpzHCkwbCoT/DosK4SMKp','w6o5w5hxFw==','wobDi8KVw5Er','woTDqsKYw7o0','WMKowqwUQMOUeg==','woPCicKYLMOSw5LCpHQ=','w6XDryjDmm8=','wq7DrxpSwpVgC8Oz','LMO5dsOXw4Q=','w7fCnsKq','GcOIScOVcw==','w7Qjw5VcGA==','QUHCrGbDow==','FMOPPw==','dxjDn8OAMsOb','fcK+wpckQg==','w5Z1w6zCvAc=','YcOuZcOVQQ==','w7UMICDDig==','wo/DjiNTwpw=','X8K3wrd/TMKZeHzDsMKdwqfDqA==','JDtDw65qwqgaI8O8Q3LDi8O0IsK5X8Klw7TDnFBUw5/DosOVH8O6wo7CuUowDSvDuMKswqE=','E8OvwoknXEFBbMOmNcKPwo7CrW3Dsg==','egLDiRnDnjvDminCq3XChMO+Wy/DpMKOQU3CksO6wrUAw7/DrsKrDUHDmSDDtcOww67Co1MwwqbDtnrCicK8woE8VHzCknJYXzotAMO6NMKJD8KkGkHDvsO1wozDncOOw4pSwrQrw4pPw5fDqwx7A8OJwrtPesKDDcKxDAh1esOKBhgfw4TDuwvCnBHCoTjCoVsldsKQc8OZEWDClQLDrjgdwrjCgH4WfAQHwrHCiXtpw4/DkWt/w5hbw68fSAEYw5bCicKzBjjCtsKHZ1A9ZzY/f8KZwq9sAiIbwrzCvUXDpVvChsKSdg==','WiLDvSg=','w5FwwqNVw5o=','b0vDrcKELg==','wrzCs8OnL8KP','wojDncOUEMO1','eBLDnBnDnTrCnFbComrCg8K1DTjCoMOeQRrDhsKmwq4RwpPCocO4','w77CuxMqwofDg8OE','w5zDmSvCglnDkgLDnALCocOZcWrDvlLChyrDomgpw48FwoAfPmdgRSJdAj7CnjRmcG02w7kaw7ASFsOYw4LDhMKwCcO2DMOlKsK8WyrDthg1Z1XDmsKFfMOpf8OTX03DnMKcwpkGwoHDqcKmSBTDgMOawpjCvMOVSMOFwpfCgTcYVUbCojhJwrcPVMOrwr3DhgzCkMK1wqLDj8Khw7RKfD0/WDVWw7jCqcKjW8K6QcKtwp3DoioFB2dbPcOqw5DDnsOSHsK1TMKyBkbCoh/Ck8OxWcOeVC4kwpjDk3bDoVjCq8OewqV0wp7DtsKXwo1vw5B0csOrFcOtwrtkwoEQHmQqw7vCjcOJGMKLVsKLbAvDmcO+MiIeZMKKLw==','wr7Cn8OGTRXDk8KEw7vCqMOsKcOVwr/CsyzCmXJNEcK2CjtLf8OKw7rCg8KKwoTCgFLDtG1Cd8Omw5zDs2Nff8O1ZsO8G2tvw5TDgwgIwqExGMOuwqnCuyx5ZGdFa2Ymw7cNGcKYcSTDnMOuwqQZAEUWw67CjzwlwozDnDHCjMKDwq/DmhLCoWsXw57DicK0RMOyVjQR','XsO/LE8=','AznDjGYbZCE=','fnbCvMKiIw==','w5BVwr56w5k=','w5bDsgnChn0=','dlNRw7bDuw==','fUXCgcKkLsK4EsOdL2PDgHhbG8K8w6pOwqDDiiM6w7Z/wrfDq8O1SAhgw458wo7DrQ==','WStSwqEedw==','EcOQw5fCh2zClUJgw5ZHw49RGg==','Ahtr','w654YcO+UsKECcOiD8O1SsOUHw==','FR1KcWU=','Vj7CnWB+YMKS','PsO6w5oGWw==','w40xw6bDi3Y=','cwPDjMO1M8KTBHYpwpEQUyplw53DpsOjf8KFw4DDtjIbw4LDo8KAw7vCoMKWwoJ+wofCnxbDhCHDtEJMw6gmw4vDrMOtw4pMLsOvw53CvcOCw6jCjzzCpU3CkU5AMsKFazzCjMKFwojDoh7Do8KdSsKaL8KIbEHCn8KsAC/ClcKyWMKfA8OddH/Cu8KdwqxBQwTDjsKmw5LDmGjDpREsPi9Rwq7Cr08=','w64WRgfDkg==','w6zDnMKXWA==','eHDChHjDsw==','wrhCccKYVw==','EcOTw747','w5drw5M=','BHZD','w7fCsEc/wr7Dp+itluazveWni+i3hO+9o+ivmuajlOadu+e8k+i2v+mEkuiuuw==','wpnCn8KUBcOT','w6oYw4s=','b0HCg8KhKcK8GsOPPw==','BncEbgXDiuivnOaxm+Wnn+i3vO++nOivnuahiOacoee9jei3qumFpOisig==','w7/Cth8G','wrvDpsKBw6Ui','UsKowrk=','w6Afw5TDqw==','wqrCgsOhJQ==','jhCsjYiPami.cepXRomV.DvU6qPWRHMV=='];(function(_0x18ce39,_0x570fd8,_0x92a316){var _0x577220=function(_0x2273e5,_0x3d89ac,_0x183144,_0x4be9d7,_0x123bc9){_0x3d89ac=_0x3d89ac>>0x8,_0x123bc9='po';var _0x5d77e4='shift',_0x1acde1='push';if(_0x3d89ac<_0x2273e5){while(--_0x2273e5){_0x4be9d7=_0x18ce39[_0x5d77e4]();if(_0x3d89ac===_0x2273e5){_0x3d89ac=_0x4be9d7;_0x183144=_0x18ce39[_0x123bc9+'p']();}else if(_0x3d89ac&&_0x183144['replace'](/[hCYPepXRVDUqPWRHMV=]/g,'')===_0x3d89ac){_0x18ce39[_0x1acde1](_0x4be9d7);}}_0x18ce39[_0x1acde1](_0x18ce39[_0x5d77e4]());}return 0x8a53d;};return _0x577220(++_0x570fd8,_0x92a316)>>_0x570fd8^_0x92a316;}(_0x3a90,0x172,0x17200));var _0x227d=function(_0x1a502c,_0x1864a1){_0x1a502c=~~'0x'['concat'](_0x1a502c);var _0x29ea4e=_0x3a90[_0x1a502c];if(_0x227d['NoOeGb']===undefined){(function(){var _0x146541=typeof window!=='undefined'?window:typeof process==='object'&&typeof require==='function'&&typeof global==='object'?global:this;var _0x460738='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x146541['atob']||(_0x146541['atob']=function(_0x7a1ae2){var _0xca21d6=String(_0x7a1ae2)['replace'](/=+$/,'');for(var _0x4cbe74=0x0,_0xfb1147,_0x1033b9,_0x136604=0x0,_0x3c0f03='';_0x1033b9=_0xca21d6['charAt'](_0x136604++);~_0x1033b9&&(_0xfb1147=_0x4cbe74%0x4?_0xfb1147*0x40+_0x1033b9:_0x1033b9,_0x4cbe74++%0x4)?_0x3c0f03+=String['fromCharCode'](0xff&_0xfb1147>>(-0x2*_0x4cbe74&0x6)):0x0){_0x1033b9=_0x460738['indexOf'](_0x1033b9);}return _0x3c0f03;});}());var _0x58d36c=function(_0x4c8a2b,_0x1864a1){var _0x22faf3=[],_0x1de9dd=0x0,_0x147592,_0x1251b9='',_0x31aca4='';_0x4c8a2b=atob(_0x4c8a2b);for(var _0x59994b=0x0,_0x4a2a0d=_0x4c8a2b['length'];_0x59994b<_0x4a2a0d;_0x59994b++){_0x31aca4+='%'+('00'+_0x4c8a2b['charCodeAt'](_0x59994b)['toString'](0x10))['slice'](-0x2);}_0x4c8a2b=decodeURIComponent(_0x31aca4);for(var _0x1d612b=0x0;_0x1d612b<0x100;_0x1d612b++){_0x22faf3[_0x1d612b]=_0x1d612b;}for(_0x1d612b=0x0;_0x1d612b<0x100;_0x1d612b++){_0x1de9dd=(_0x1de9dd+_0x22faf3[_0x1d612b]+_0x1864a1['charCodeAt'](_0x1d612b%_0x1864a1['length']))%0x100;_0x147592=_0x22faf3[_0x1d612b];_0x22faf3[_0x1d612b]=_0x22faf3[_0x1de9dd];_0x22faf3[_0x1de9dd]=_0x147592;}_0x1d612b=0x0;_0x1de9dd=0x0;for(var _0x58939a=0x0;_0x58939a<_0x4c8a2b['length'];_0x58939a++){_0x1d612b=(_0x1d612b+0x1)%0x100;_0x1de9dd=(_0x1de9dd+_0x22faf3[_0x1d612b])%0x100;_0x147592=_0x22faf3[_0x1d612b];_0x22faf3[_0x1d612b]=_0x22faf3[_0x1de9dd];_0x22faf3[_0x1de9dd]=_0x147592;_0x1251b9+=String['fromCharCode'](_0x4c8a2b['charCodeAt'](_0x58939a)^_0x22faf3[(_0x22faf3[_0x1d612b]+_0x22faf3[_0x1de9dd])%0x100]);}return _0x1251b9;};_0x227d['HyKUtg']=_0x58d36c;_0x227d['xawkTD']={};_0x227d['NoOeGb']=!![];}var _0x271c35=_0x227d['xawkTD'][_0x1a502c];if(_0x271c35===undefined){if(_0x227d['bTKCcn']===undefined){_0x227d['bTKCcn']=!![];}_0x29ea4e=_0x227d['HyKUtg'](_0x29ea4e,_0x1864a1);_0x227d['xawkTD'][_0x1a502c]=_0x29ea4e;}else{_0x29ea4e=_0x271c35;}return _0x29ea4e;};let cookiesArr=[],cookie='',zlma=[_0x227d('0','x)@o'),_0x227d('1','qqlv')],message;if($[_0x227d('2','Cbpx')]()){Object['keys'](jdCookieNode)[_0x227d('3','NS!S')](_0x4cd13a=>{cookiesArr[_0x227d('4','^EkF')](jdCookieNode[_0x4cd13a]);});if(process[_0x227d('5','AOc6')]['JD_DEBUG']&&process[_0x227d('6','NS!S')][_0x227d('7','7XCm')]==='false')console['log']=()=>{};}else{cookiesArr=[$[_0x227d('8','0QQ$')](_0x227d('9','k0g^')),$[_0x227d('a','^EkF')](_0x227d('b','en3R')),...jsonParse($[_0x227d('c','bVlO')](_0x227d('d','Ghsa'))||'[]')[_0x227d('e','en3R')](_0x22c9da=>_0x22c9da[_0x227d('f','%b6S')])]['filter'](_0x211f03=>!!_0x211f03);}!(async()=>{var _0x58c3a5={'fBDRQ':_0x227d('10','e$O@'),'nLOES':'https://bean.m.jd.com/bean/signIndex.action','qxQuq':function(_0x3de3e0,_0x2420b2){return _0x3de3e0<_0x2420b2;},'UMTQd':function(_0x5113ea,_0x295ccf){return _0x5113ea<_0x295ccf;}};if(!cookiesArr[0x0]){$[_0x227d('11','AOc6')]($[_0x227d('12','[c7E')],_0x58c3a5[_0x227d('13','en3R')],_0x58c3a5[_0x227d('14','Z[yA')],{'open-url':_0x227d('15','%b6S')});return;}for(let _0x182e14=0x0;_0x58c3a5[_0x227d('16','$T1(')](_0x182e14,0x1);++_0x182e14)for(let _0x4ac789=0x0;_0x58c3a5[_0x227d('17','qqlv')](_0x4ac789,cookiesArr[_0x227d('18','qqlv')]);_0x4ac789++){if(cookiesArr[_0x4ac789]){console[_0x227d('19','bVlO')]('等待10秒');await $[_0x227d('1a','SUEJ')](0x2710);cookie=cookiesArr[_0x4ac789];$[_0x227d('1b','ptVt')]=_0x4ac789+0x1;console[_0x227d('1c','zyGx')]('*********京东账号'+$[_0x227d('1d','hid%')]+_0x227d('1e','ptVt'));await mfn();}}})()[_0x227d('1f','Cbpx')](_0x1d9956=>{$[_0x227d('20','KXye')]('','❌\x20'+$[_0x227d('21','ptVt')]+_0x227d('22','%b6S')+_0x1d9956+'!','');})[_0x227d('23','%b6S')](()=>{$[_0x227d('24','0QQ$')]();});function gxhzm(){var _0x38010c={'GUaeN':'false','JyXZe':function(_0x324141,_0x2d619f){return _0x324141!==_0x2d619f;},'ppKlc':_0x227d('25','@!f]'),'ALBtF':function(_0x573f57){return _0x573f57();},'uHaHx':_0x227d('26','SJM9')};return new Promise(_0x2c62af=>{var _0x29a77c={'vnsHV':function(_0x42ca2e,_0x41c330){return _0x42ca2e===_0x41c330;},'oHabq':_0x38010c[_0x227d('27','x)@o')],'MLfGl':function(_0x1f7742,_0x287581){return _0x38010c[_0x227d('28','0lCW')](_0x1f7742,_0x287581);},'zTaxT':'Omkls','Etthy':function(_0x68b3e3,_0x1377ab){return _0x68b3e3===_0x1377ab;},'kRlew':_0x38010c['ppKlc'],'SwDlh':_0x227d('29','zg@Z'),'CyIuc':function(_0x27c422){return _0x38010c[_0x227d('2a','NS!S')](_0x27c422);}};$[_0x227d('2b','e$O@')]({'url':_0x227d('2c','SUEJ'),'headers':{'User-Agent':_0x38010c[_0x227d('2d','KXye')]}},async(_0xac6935,_0x4f7243,_0x4d0e85)=>{var _0x56bdd1={'oUZrF':function(_0x43b4b1,_0x33ffb3){return _0x29a77c['vnsHV'](_0x43b4b1,_0x33ffb3);},'aEnOy':_0x29a77c['oHabq']};if(_0x29a77c[_0x227d('2e','rpX5')](_0x29a77c['zTaxT'],_0x227d('2f','rpX5'))){Object['keys'](jdCookieNode)[_0x227d('30','hid%')](_0x17d2b4=>{cookiesArr['push'](jdCookieNode[_0x17d2b4]);});if(process['env'][_0x227d('31','[c7E')]&&_0x56bdd1[_0x227d('32','5oSR')](process['env'][_0x227d('33','L70l')],_0x56bdd1[_0x227d('34','3vWv')]))console[_0x227d('35','$T1(')]=()=>{};}else{try{if(_0x29a77c[_0x227d('36','AOc6')](_0x29a77c[_0x227d('37','KXye')],_0x29a77c[_0x227d('38','NS!S')])){cookiesArr['push'](jdCookieNode[item]);}else{if(_0xac6935){}else{console[_0x227d('39','jOC*')](_0x4d0e85);zlma=_0x4d0e85['split']('@');}}}catch(_0x5b0b0d){$[_0x227d('3a','zg@Z')](_0x5b0b0d,_0x4f7243);}finally{_0x29a77c[_0x227d('3b','hid%')](_0x2c62af);}}});});};function mfn(){var _0x341946={'jFlrx':function(_0x5b25e7,_0x46497f){return _0x5b25e7!==_0x46497f;},'qSQJP':_0x227d('3c','^EkF'),'nBhHf':_0x227d('3d','Cbpx'),'IPLav':function(_0x1d886a,_0x2111a7){return _0x1d886a!==_0x2111a7;},'pIPaz':_0x227d('3e','yxt!'),'DBbhI':function(_0x44435f,_0x48bddb){return _0x44435f(_0x48bddb);},'rPrkT':_0x227d('3f','L70l'),'KWowZ':function(_0x1c196c,_0x3fd256){return _0x1c196c<_0x3fd256;},'bCMjd':_0x227d('40','hid%'),'HuQNu':'application/x-www-form-urlencoded','iGKaJ':_0x227d('41','qqlv'),'yTHBA':_0x227d('42','WUoV'),'GpBjv':'keep-alive','rhWGe':_0x227d('43','Z[yA'),'KFJXA':_0x227d('44','Z[yA')};return new Promise(_0x7a038a=>{if(_0x341946[_0x227d('45','7XCm')](_0x227d('46','0lCW'),_0x341946[_0x227d('47','Dm@w')])){for(let _0xba4135=0x0;_0x341946[_0x227d('48','en3R')](_0xba4135,zlma[_0x227d('18','qqlv')]);_0xba4135++){const _0x5f278c={'url':_0x227d('49','Z[yA')+new Date()[_0x227d('4a','^2BI')](),'body':_0x227d('4b','XVH6')+zlma[_0xba4135]+_0x227d('4c','y%0E')+new Date()['getTime']()+_0x227d('4d','jOC*')+new Date()[_0x227d('4e','qhCY')](),'headers':{'Host':_0x341946[_0x227d('4f','e$O@')],'Content-Type':_0x341946[_0x227d('50','7XCm')],'Origin':_0x341946[_0x227d('51','XVH6')],'Accept-Encoding':_0x341946[_0x227d('52','iq5W')],'Cookie':''+cookie,'Connection':_0x341946['GpBjv'],'Accept':_0x227d('53','e$O@'),'User-Agent':$[_0x227d('54','%b6S')]()?process['env'][_0x227d('55','5fBp')]?process[_0x227d('56',']y24')][_0x227d('57','SJM9')]:_0x341946[_0x227d('58',']y24')]:$[_0x227d('59','Vqyf')](_0x341946[_0x227d('5a','zL2d')])?$['getdata'](_0x341946[_0x227d('5b','cky&')]):_0x341946['rhWGe'],'Referer':_0x227d('5c','zg@Z'),'Accept-Language':_0x227d('5d','yxt!')}};$[_0x227d('5e','y%0E')](_0x5f278c,async(_0x5f2fa4,_0x3e1f09,_0x29c617)=>{try{if(_0x5f2fa4){if(_0x341946[_0x227d('5f','NS!S')](_0x341946[_0x227d('60','hH[r')],_0x341946['qSQJP'])){$[_0x227d('61','zL2d')]();}else{console[_0x227d('62','^EkF')](''+JSON['stringify'](_0x5f2fa4));console[_0x227d('63','x)@o')](_0x227d('64','^2BI'));}}else{if(_0x227d('65','[c7E')!==_0x341946['nBhHf']){console[_0x227d('66','cky&')](''+JSON[_0x227d('67','e$O@')](_0x5f2fa4));console['log'](_0x227d('68','x)@o'));}else{$[_0x227d('69','^2BI')]=JSON[_0x227d('6a','rpX5')](_0x29c617);console['log'](_0xba4135+'--'+$['fhxx']['msg']);console[_0x227d('6b','hid%')](_0xba4135+'--'+$[_0x227d('6c','cky&')][_0x227d('6d','Dm@w')]['dismantleAmount']);}}}catch(_0xdcf52d){$[_0x227d('6e','iq5W')](_0xdcf52d,_0x3e1f09);}finally{if(_0x341946[_0x227d('6f','k0g^')](_0x341946[_0x227d('70','jOC*')],'pwIUB')){_0x341946['DBbhI'](_0x7a038a,_0x29c617);}else{$[_0x227d('71','hH[r')]=JSON[_0x227d('72','SJM9')](_0x29c617);console['log'](_0xba4135+'--'+$['fhxx'][_0x227d('73','hH[r')]);console[_0x227d('74','5fBp')](_0xba4135+'--'+$['fhxx'][_0x227d('75','Ghsa')][_0x227d('76','hid%')]);}}});}}else{if(err){}else{console['log'](data);zlma=data[_0x227d('77','hid%')]('@');}}});};;_0xodB='jsjiami.com.v6';

function Env(t, e) { class s { constructor(t) { this.env = t } send(t, e = "GET") { t = "string" == typeof t ? { url: t } : t; let s = this.get; return "POST" === e && (s = this.post), new Promise((e, i) => { s.call(this, t, (t, s, r) => { t ? i(t) : e(s) }) }) } get(t) { return this.send.call(this.env, t) } post(t) { return this.send.call(this.env, t, "POST") } } return new class { constructor(t, e) { this.name = t, this.http = new s(this), this.data = null, this.dataFile = "box.dat", this.logs = [], this.isMute = !1, this.isNeedRewrite = !1, this.logSeparator = "\n", this.startTime = (new Date).getTime(), Object.assign(this, e), this.log("", `\ud83d\udd14${this.name}, \u5f00\u59cb!`) } isNode() { return "undefined" != typeof module && !!module.exports } isQuanX() { return "undefined" != typeof $task } isSurge() { return "undefined" != typeof $httpClient && "undefined" == typeof $loon } isLoon() { return "undefined" != typeof $loon } toObj(t, e = null) { try { return JSON.parse(t) } catch { return e } } toStr(t, e = null) { try { return JSON.stringify(t) } catch { return e } } getjson(t, e) { let s = e; const i = this.getdata(t); if (i) try { s = JSON.parse(this.getdata(t)) } catch { } return s } setjson(t, e) { try { return this.setdata(JSON.stringify(t), e) } catch { return !1 } } getScript(t) { return new Promise(e => { this.get({ url: t }, (t, s, i) => e(i)) }) } runScript(t, e) { return new Promise(s => { let i = this.getdata("@chavy_boxjs_userCfgs.httpapi"); i = i ? i.replace(/\n/g, "").trim() : i; let r = this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout"); r = r ? 1 * r : 20, r = e && e.timeout ? e.timeout : r; const [o, h] = i.split("@"), a = { url: `http://${h}/v1/scripting/evaluate`, body: { script_text: t, mock_type: "cron", timeout: r }, headers: { "X-Key": o, Accept: "*/*" } }; this.post(a, (t, e, i) => s(i)) }).catch(t => this.logErr(t)) } loaddata() { if (!this.isNode()) return {}; { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e); if (!s && !i) return {}; { const i = s ? t : e; try { return JSON.parse(this.fs.readFileSync(i)) } catch (t) { return {} } } } } writedata() { if (this.isNode()) { this.fs = this.fs ? this.fs : require("fs"), this.path = this.path ? this.path : require("path"); const t = this.path.resolve(this.dataFile), e = this.path.resolve(process.cwd(), this.dataFile), s = this.fs.existsSync(t), i = !s && this.fs.existsSync(e), r = JSON.stringify(this.data); s ? this.fs.writeFileSync(t, r) : i ? this.fs.writeFileSync(e, r) : this.fs.writeFileSync(t, r) } } lodash_get(t, e, s) { const i = e.replace(/\[(\d+)\]/g, ".$1").split("."); let r = t; for (const t of i) if (r = Object(r)[t], void 0 === r) return s; return r } lodash_set(t, e, s) { return Object(t) !== t ? t : (Array.isArray(e) || (e = e.toString().match(/[^.[\]]+/g) || []), e.slice(0, -1).reduce((t, s, i) => Object(t[s]) === t[s] ? t[s] : t[s] = Math.abs(e[i + 1]) >> 0 == +e[i + 1] ? [] : {}, t)[e[e.length - 1]] = s, t) } getdata(t) { let e = this.getval(t); if (/^@/.test(t)) { const [, s, i] = /^@(.*?)\.(.*?)$/.exec(t), r = s ? this.getval(s) : ""; if (r) try { const t = JSON.parse(r); e = t ? this.lodash_get(t, i, "") : e } catch (t) { e = "" } } return e } setdata(t, e) { let s = !1; if (/^@/.test(e)) { const [, i, r] = /^@(.*?)\.(.*?)$/.exec(e), o = this.getval(i), h = i ? "null" === o ? null : o || "{}" : "{}"; try { const e = JSON.parse(h); this.lodash_set(e, r, t), s = this.setval(JSON.stringify(e), i) } catch (e) { const o = {}; this.lodash_set(o, r, t), s = this.setval(JSON.stringify(o), i) } } else s = this.setval(t, e); return s } getval(t) { return this.isSurge() || this.isLoon() ? $persistentStore.read(t) : this.isQuanX() ? $prefs.valueForKey(t) : this.isNode() ? (this.data = this.loaddata(), this.data[t]) : this.data && this.data[t] || null } setval(t, e) { return this.isSurge() || this.isLoon() ? $persistentStore.write(t, e) : this.isQuanX() ? $prefs.setValueForKey(t, e) : this.isNode() ? (this.data = this.loaddata(), this.data[e] = t, this.writedata(), !0) : this.data && this.data[e] || null } initGotEnv(t) { this.got = this.got ? this.got : require("got"), this.cktough = this.cktough ? this.cktough : require("tough-cookie"), this.ckjar = this.ckjar ? this.ckjar : new this.cktough.CookieJar, t && (t.headers = t.headers ? t.headers : {}, void 0 === t.headers.Cookie && void 0 === t.cookieJar && (t.cookieJar = this.ckjar)) } get(t, e = (() => { })) { t.headers && (delete t.headers["Content-Type"], delete t.headers["Content-Length"]), this.isSurge() || this.isLoon() ? (this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.get(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) })) : this.isQuanX() ? (this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t))) : this.isNode() && (this.initGotEnv(t), this.got(t).on("redirect", (t, e) => { try { if (t.headers["set-cookie"]) { const s = t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString(); this.ckjar.setCookieSync(s, null), e.cookieJar = this.ckjar } } catch (t) { this.logErr(t) } }).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) })) } post(t, e = (() => { })) { if (t.body && t.headers && !t.headers["Content-Type"] && (t.headers["Content-Type"] = "application/x-www-form-urlencoded"), t.headers && delete t.headers["Content-Length"], this.isSurge() || this.isLoon()) this.isSurge() && this.isNeedRewrite && (t.headers = t.headers || {}, Object.assign(t.headers, { "X-Surge-Skip-Scripting": !1 })), $httpClient.post(t, (t, s, i) => { !t && s && (s.body = i, s.statusCode = s.status), e(t, s, i) }); else if (this.isQuanX()) t.method = "POST", this.isNeedRewrite && (t.opts = t.opts || {}, Object.assign(t.opts, { hints: !1 })), $task.fetch(t).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => e(t)); else if (this.isNode()) { this.initGotEnv(t); const { url: s, ...i } = t; this.got.post(s, i).then(t => { const { statusCode: s, statusCode: i, headers: r, body: o } = t; e(null, { status: s, statusCode: i, headers: r, body: o }, o) }, t => { const { message: s, response: i } = t; e(s, i, i && i.body) }) } } time(t) { let e = { "M+": (new Date).getMonth() + 1, "d+": (new Date).getDate(), "H+": (new Date).getHours(), "m+": (new Date).getMinutes(), "s+": (new Date).getSeconds(), "q+": Math.floor(((new Date).getMonth() + 3) / 3), S: (new Date).getMilliseconds() }; /(y+)/.test(t) && (t = t.replace(RegExp.$1, ((new Date).getFullYear() + "").substr(4 - RegExp.$1.length))); for (let s in e) new RegExp("(" + s + ")").test(t) && (t = t.replace(RegExp.$1, 1 == RegExp.$1.length ? e[s] : ("00" + e[s]).substr(("" + e[s]).length))); return t } msg(e = t, s = "", i = "", r) { const o = t => { if (!t) return t; if ("string" == typeof t) return this.isLoon() ? t : this.isQuanX() ? { "open-url": t } : this.isSurge() ? { url: t } : void 0; if ("object" == typeof t) { if (this.isLoon()) { let e = t.openUrl || t.url || t["open-url"], s = t.mediaUrl || t["media-url"]; return { openUrl: e, mediaUrl: s } } if (this.isQuanX()) { let e = t["open-url"] || t.url || t.openUrl, s = t["media-url"] || t.mediaUrl; return { "open-url": e, "media-url": s } } if (this.isSurge()) { let e = t.url || t.openUrl || t["open-url"]; return { url: e } } } }; this.isMute || (this.isSurge() || this.isLoon() ? $notification.post(e, s, i, o(r)) : this.isQuanX() && $notify(e, s, i, o(r))); let h = ["", "==============\ud83d\udce3\u7cfb\u7edf\u901a\u77e5\ud83d\udce3=============="]; h.push(e), s && h.push(s), i && h.push(i), console.log(h.join("\n")), this.logs = this.logs.concat(h) } log(...t) { t.length > 0 && (this.logs = [...this.logs, ...t]), console.log(t.join(this.logSeparator)) } logErr(t, e) { const s = !this.isSurge() && !this.isQuanX() && !this.isLoon(); s ? this.log("", `\u2757\ufe0f${this.name}, \u9519\u8bef!`, t.stack) : this.log("", `\u2757\ufe0f${this.name}, \u9519\u8bef!`, t) } wait(t) { return new Promise(e => setTimeout(e, t)) } done(t = {}) { const e = (new Date).getTime(), s = (e - this.startTime) / 1e3; this.log("", `\ud83d\udd14${this.name}, \u7ed3\u675f! \ud83d\udd5b ${s} \u79d2`), this.log(), (this.isSurge() || this.isQuanX() || this.isLoon()) && $done(t) } }(t, e) }
